#project 

# 개요

이번 프로젝트는 앱으로 구현할 예정이며 오프라인 상황에서도 핸드폰으로 알림이 가게끔 하려고 한다.
원래 SSE 를 사용하여 실시간성을 높이려고 했지만, SSE 는 온라인일 때만 알림을 수신할 수 있고, 오프라인에서는 수신할 수 없다.
FCM 은 구글이 제공하는 크로스 플랫폼 메시징 솔루션이다. 서버에서 사용자의 기기로 알림 메시지나 데이터 메시지를 전송해준다.
FCM 은 사용자가 오프라인 상태에서도 OS 레벨에서 하나의 공유된 연결을 통해 알림을 띄운다.
![[../../images/fcm.png]]

## FCM 동작원리

1. **앱 <-> Firebase 연결** : 앱이 처음 시행될 때, FCM은 디바이스를 FCM 서버에 등록하고 고유한 등록 토큰을 발급한다. 이 토큰은 디바이스를 식별할 때 사용한다.
2. **서버에 토큰 저장** : 앱은 토큰을 서버로 보내고, 서버는 토큰을 DB에 저장한다.
3. **이벤트 발생** 
4. **서버 -> Firebase API 호출** : 서버는 이벤트 기반으로 사용자의 토큰을 DB에서 조회하고 토큰과 이벤트의 내용을 가지고 FCM 서버 API 를 호출한다.
5. **메시지 전송** : FCM 서버가 해당 토큰의 기기를 찾고 알림 메시지를 전송한다.
