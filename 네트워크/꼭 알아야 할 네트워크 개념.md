#네트워크 

#  개요
- **공인IP/사설IP**
- **서브넷(Subnet)** 
- **NAT**
- **LAN/WAN/VPN** 
___
## 공인IP (Public IP)

- 인터넷에서 유일한 주소
- 외부에서 접근 가능한 IP
> **EC2 Public IP** : 외부에서 접속할 때 사용하는 주소

## 사설IP (Private IP)

- **내부 네트웨크(LAN)에서만** 유효, 인터넷에서는 사용 불가
- 라우터(공유기)가 NAT(Network Address Translation) 으로 공인 IP 하나에 여러 사설 IP 매핑

> **EC2 Private IP** : 같은 VPC 내부 서비스끼리 통신할 때 사용
- ***단일 EC2 + docker*** : Docker 내부의 가상의 네트워크(bridge 등)로 자동으로 사설 IP 할당하여 컨테이너들끼리 통신
- ***멀티 EC2*** : VPC + Subnet 에서 부여되는 사설IP 로 통신

## 서브넷 (Subnet)

- 네트워크를 나누는 단위(IP 범위)
- **Public Subnet** : 외부 인터넷 게이트웨이와 연결된 구역
- **Private Subnet** : 외부 인터넷 직접 접속 불가 -> NAT Gateway 통해서만 외부로 나감

## NAT(Network Address Translation)

- 사설망 -> 인터넷 외부로 나갈 때 공인 IP 로 바꿔줌
>ex) 가정집 공유기, AWS NAT Gateway

*가정집 공유기(NAT) 작동 원리*
- **기기 접속**    
    - 와이파이 비밀번호 입력 → 공유기가 기기한테 **사설 IP (예: 192.168.0.12)** 할당.
    - 공유기를 사용하는 모든 기기는 다른 사설IP 를 할당 받음
- **외부 사이트 접속**    
    - 노트북이 `www.naver.com`에 접속하려 하면, 패킷이 공유기까지 감.        
    - 공유기는 이걸 자기 **공인 IP (예: 121.xxx.xxx.xxx)** 로 바꿔서 인터넷에 보냄.      
    - 공유기를 사용하는 모든 기기는 같은 공인IP 주소로 인터넷과 연결
- **응답 받기**    
    - 네이버 서버는 "121.xxx.xxx.xxx" 로만 응답을 줌 (내부 기기의 사설IP는 모름).        
    - 공유기가 응답을 받아보고 “아 이건 노트북(192.168.0.12) 요청이었지” 하고 다시 매핑해서 돌려줌.

## 포트 포워딩

만약 외부에서 사설IP 의 특정 서비스(ex: 3000)로 접속하려면 어떻게 해야할까?

사설 IP 는 SSH 포트(22)로 접속해야 하는데 여기서 SSH 터널링을 통해서 나의 포트(노트북 또는 브라우저)로 **사설IP 의 특정 포트로 접속**하기 위해서 포트 포워딩을 사용한다.

``ssh -L 3000:10.178.0.4:3000 seoarc0304@dev.kitchenlog.shop

위의 ssh 명령어는 특정 사설IP 의 3000번 주소로 접속하기 위한 ssh 터널링 예시이다.
`-L`은 나의 로컬 주소이다.

`dev.kitchenlog.shop` 안에 있는 `10.178.0.4` 사설 IP 주소로 접속하기 위해서 

1. 앞의 3000번(내 컴퓨터) 에서 사용할 포트를
2. `10.178.0.4` 의 뒤의 3000번 포트에 접속할 수 있다.

내 컴퓨터와 `dev.kitchenlog.shop` 서버 사이에 암호화된 데이터 전송을 위한 터널을 만들어서
`10.178.0.4:3000`로 접속하는 방식이다.
`dev.kitchenlog.shop` 서버가 내 컴퓨터의 3000번 포트를 해당 사설IP 3000번 포트로 접속가능하게 해준다.

포트 포워딩을 풀어서 말하면 특정 IP 와 포트로 들어온 신호를 다른 IP와 포트로 재전송 해주는 프로토콜이다.
위 터널링은 내 컴퓨터에 있는 **로컬 그라파나 브라우저**에서 사설IP 주소인 `10.178.0.4`의 그라파나 서비스(3000) 에 접속하기 위해서 사용한다.