#네트워크  #nginx 

# 개요

단일 서버에 많은 사용자들이 몰려 요청이 많아지면 서버에 부하가 생길 수 밖에 없다.

로드밸런서는 이렇게 서버에 가해지는 부하를 여러 개의 서버로 분산해주는 장치 또는 기술을 통칭한다.

보통 [[Nginx]] 를 이용해서 로드밸런서를 구현한다.
___
# 📌 Scale - up  /  Scale - out

### Scale-up
: 서버 자체의 성능을 확장하는 것을 의미한다.
Ex) CPU 성능을 m1 -> m3 로 업그레이드

### Scale-out
: 기존 서버와 동일하거나 낮은 성능의 서버를 두 대 이상 증설하여 운영하는 것을 의미한다.

✅ 이때 여러 서버로 나누어 트래픽을 균등하게 분산해주는 **로드밸런싱**이 필요
___

# 📌 OSI 계층별 분류

### L4 로드밸런서 (Transport Layer - 4계층)
- **동작 계층** : 전송 계층 (TCP/UDP)
- **분산 기준** : IP 주소, 포트번호
- **특징** : 빠른 처리 속도, 단순 구조

```nginx
# Nginx L4 로드밸런싱 설정
upstream backend_servers {

# Nginx 가 분산 처리해서 갈 목적지 IP주소
    server 192.168.1.10:8080;
    server 192.168.1.11:8080;
    server 192.168.1.12:8080;
}

server {
    listen 80;
    location / {
        proxy_pass http://backend_servers;
    }
}
```

### L7 로드밸런서(Application Layer - 7계층)
- **동작 계층** : 애플리케이션 계층(HTTP)
- **분산 기준** : URL,HTTP 헤더, 쿠키 등
- **특징**
	1. 특정한 패턴을 지닌 바이러스를 감지해 네트워크 보호
	2. Dos/DDos 같은 트래픽 피터링 가능

```nginx
# Nginx L7 로드밸런싱 설정
# Nginx 가 분산 처리해서 갈 목적지 url
upstream api_servers {
    server api1.example.com:8080;
    server api2.example.com:8080;
}

upstream web_servers {
    server web1.example.com:8080;
    server web2.example.com:8080;
}

server {
    listen 80;
    
    location /api/ {
        proxy_pass http://api_servers;
    }
    
    location / {
        proxy_pass http://web_servers;
    }
}
```

#### L4 vs L7

![[스크린샷 2025-06-18 오후 4.12.00.png]]


___

# 로드밸런싱 알고리즘

### 1. 라운드 로빈 (Round Robin)

- **개념** : 서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식
- **특징** : 
	1. 요청을 순서대로 배분하기 때문에 여러 서버가 동일한 스펙 가지고 있음
	2. 서버와의 연결(세션)이 오래 지속되지 않는 경우에 적합
### 2. 가중 라운드로빈 방식
- **개념** : 각 서버마다 가중치를 매기고 가중치가 높은 서버에 요청을 우선적으로 배분
- **특징** : 
	1. 서버의 트래픽 능력이 상이한 경우 사용
	2. 가중치에 따라서 요청 전달

### 3. IP 해시 방식
- **개념** : 클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하느 방식
- **특징** : 사용자의 IP 를 해싱해 요청을 분배하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장

### 4. 최소 연결 방식
- **개념** : 요청이 들어온 시점에 가장 적은 연결상태를 보이는 서버에 우선적 배분
- **특징** : 자주 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합

### 5. 최소 리스폰타임
- **개념** : 서버의 현재 연결 상태와 응답시간을 고려해 트래픽 배분
	
