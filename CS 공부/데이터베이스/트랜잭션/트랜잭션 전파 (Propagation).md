#spring개념 #database 

하나의 트랜잭션이 걸려있는 메서드 안에서 또 다른 트랜잭션이 걸려 있는 메서드를 호출할 때,
이미 진행중인 트랜잭션 안에 같이 합류할 것인가? 
아니면 새로운 트랜잭션을 생성해서 별도의 트랜잭션 내에서 실행할 것인가?
를 결정해주는 것이 전파 속성이다.

전파 수준은 *현재 트랜잭션이 실행되고 있는 상태*에서 *또 다른 트랜잭션 메서드*를 실행했을 때
- 기존 트랜잭션에 합류할지
- 새로운 트랜잭션을 만들지
- 아예 합류를 거부하고 트랜잭션 위에서 동작하지 않게 할지
를 정할 수 있다.

아래는 전파 수준에 따른 동작 방식이다.

| **전파 수준**         | **기존 트랜잭션 있을 때**                  | **기존 트랜잭션 없을 때** | **설명**            | **쓰임<br>예시** |
| ----------------- | --------------------------------- | ---------------- | ----------------- | ------------ |
| **REQUIRED**      | 참여                                | 새로 생성            | 기본값. 가능하면 합류      | 보통의 비즈니스 로직  |
| **REQUIRES_NEW**  | 기존 트랜잭션 중단 <br>→ 새로 시작            | 새로 시작            | 기존과 완전히 분리        | 로깅 및 알림 발송 등 |
| **NESTED**        | Savepoint 생성                      | 새로 생성            | 부분 롤백 가능한 하위 트랜잭션 | 부가 혜택 지급     |
| **SUPPORTS**      | 참여                                | 트랜잭션 없이 실행       | 읽기 전용에 유용         | 단순 조회        |
| **NOT_SUPPORTED** | 트랜잭션 중단 후 실행 <br>(새로운 스레드, 커넥션 X) | 그냥 실행            | 트랜잭션 없이 실행해야 할 때  | 외부 I/O 작업    |
| **NEVER**         | 예외 발생                             | 그냥 실행            | 트랜잭션이 존재하면 안 됨    |              |
| **MANDATORY**     | 참여                                | 예외 발생            | 반드시 트랜잭션 있어야 함    |              |

먼저 기본값인 **REQURIED** 수준은 어떻게 동작하는 지 알아보자.

## REQUIRED, REQUIRES_NEW 에서의 물리 트랜잭션과 논리 트랜잭션

> 물리 트랜잭션 : 실제 데이터베이스의 커넥션을 이용해서 커밋, 롤백 등이 수행되는 단위이다.
> 			- 실제 커넥션에 롤백/커밋을 호출하므로 해당 트랜잭션이 끝나는 단계가 된다.

> 논리 트랜잭션 : 스프링 수준에서 트랜잭션 매니저를 통해 트랜잭션을 처리하는 단위이다.

### REQURIED 

- 현재 트랜잭션이 있으면 **참여**하고, 없으면 새로 생성한다.

REQUIRED 에서는 2개의 논리 트랜잭션을 묶어서 1개의 물리 트랜잭션을 사용한다.

![](../../../images/스크린샷%202026-01-04%2018.47.01.png)

- 모든 논리 트랜잭션이 커밋되어야 물리 트랜잭션이 커밋된다.
- 하나의 논리 트랜잭션이라도 롤백되면 물리 트랜잭션은 롤백된다.

위 전파 수준은 하나의 트랜잭션 안에서 모든 로직이 하나의 몸처럼 똑같이 커밋되거나 롤백된다.

```java
@Transactional(propagation = Propagation.REQUIRED)
```

### REQUIRES_NEW

- 기존 트랜잭션이 존재하면 **일시 정지**하고, **새로운 트랜잭션**을 시작한다.

REQUIRES_NEW 전파 수준에서는 물리 트랜잭션이 분리됨으로써 2개가 사용된다.

![](../../../images/스크린샷%202026-01-04%2018.54.39.png)


이는 곧 커넥션 자체를 2개 사용하게 되는 의미와 같으므로 주의해서 사용해야 한다. (커넥션 풀 2개 사용)

쓰임 예시 ) 보통 로깅, 감사 등 비즈니스 로직과 상관없는 실행을 할 때 별도의 트랜잭션을 분리하기 위해서 사용한다.

```java
@Transactional(propagation = Propagation.REQUIRES_NEW)
```
