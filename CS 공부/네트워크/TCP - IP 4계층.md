
## TCP / IP 

### IP (인터넷 프로토콜)

**특징** : 지정한 IP주소에 데이터 조각들을 **패킷**이라는 통신 단위로 최대한 빨리 보내는 역할
**단점** : 패킷의 순서를 보장하지 못하고 유실되어도 답이 없음

### TCP (전송 제어 프로토콜)

**특징** : 패킷 데이터의 전달을 보증하고 순서대로 수신
**신뢰성** : 데이터를 상대방에게 확실히 보내기 위해 **3 way handshaking** 방법 사용

### TCP 순서 보장 방법

1. 클라이언트는 처음에 **패킷1, 패킷2, 패킷3 순**으로 전송한다.
2. 근데 서버에는 **패킷1, 패킷3, 패킷2 순서**로 도착한다.
3. 서버는 클라이언트에게 **다시 패킷2부터 보내라고 요청**한다. (TCP 기본동작)

TCP 데이터 안에 전송 제어, 순서, 정보들이 있기 때문에 패킷을 순서대로 제어할 수 있다.

## TCP 의 연결 및 해제 과정

PORT 상태 정보
- **CLOSED** : 포트가 닫힌 상태
- **LISTEN** : 포트가 열린 상태로 연결 요청 대기 중
- **SYN_RCV** : 요청을 받고 상대방의 응답을 기다리는 중
- **ESTABLISHED** : 포트 연결 상태


`SYN` : 접속 요청 - (시퀀스 번호 전송)
`ACK` : 요청 수락
`FIN` : 연결 해제

### TCP 3 way handshake
**개념** : 실제 클라이언트와 연결 전에 가상 연결을 해서 패킷으로 수신됐는지 확인하는 동작


![](../../images/스크린샷%202026-01-28%2021.44.06.png)


1. **SYN 단계** : 클라이언트는 서버에 클라이언트 ISN을 담아 SYN을 보냄
	- ISN: 새로운 TCP 연결의 첫 번째 패킷에 할당된 임의의 시퀀스 번호
2. **SYN + ACK 단계** : 서버는 클라이언트의 SYN을 수신하고 ISN을 보내며 승인번호로 클라이언트의 ISN +1 을 보냄
3. **ACK 단계** : 클라이언트는 서버의 ISN+1 한 값인 승인번호를 담아 서버로 보냄

### TCP 4 way handshake
**개념**: 연결을 해제하기 위한 동작


![](../../images/스크린샷%202026-01-28%2021.47.51.png)


1. **클리언트 연결 해제 요청** : `FIN` 으로 설정된 세그먼트 보냄.
	 - 클라이언트는 `FIN-WAIT-1`상태로 서버 응답 대기
2. **서버 연결 해제 승인** : `ACK` 승인 세그먼트 보냄.
	- 서버는 `CLOSE_WAIT` 상태, 클라이언트는 `FIN-WAIT-2` 상태
3. **서버** : `ACK`를 보내고 클라이언트에 `FIN` 이라는 세그먼트 보냄
4. **클라이언트** : `TIME-WAIT` 상태, 서버로 해지 준비가 되었다는 `ACK`전송
5. **서버** : `CLOSED`상태, 잠시후 모든 자원의 연결 해제

`TIME-WAIT` : 소켓이 바로 소멸되지 않고, 일정 시간 유지되는 상태 (데드락 방지)

#### TCP의 연결 성립 과정과 연결 해제 과정의 단계수가 차이 나는 이유는?

 Client가 데이터 전송을 마쳤다고 해도 Server는 아직 보낼 데이터가 남아있을 수 있기 때문에 일단 FIN에 대한 ACK만 보내고, 데이터를 모두 전송한 후 자신도 FIN메세지를 보내기 때문이다.
 
## UDP 

**특징**
- 비연결지향적 프로토콜
- 데이터 전달, 순서 보장 X
- 오로지 빠른 전송을 위한 목적
- IP와 비슷하다고 보면 되고, 다른점은 PORT 와 체크섬 정도만 추가된 형태
- 단순히 데이터만 주는 **데이터그램 패킷 교환 방식**
	- 각 패킷이 독립적으로 최적의 경로를 선택하는 방식



![](../../images/스크린샷%202026-01-28%2021.12.57.png)


## TCP / IP 4계층


![](../../images/스크린샷%202026-01-28%2021.15.18.png)

### L1 : Network Layer (OSI 물리 + 데이터링크 계층)

- Node-to-Node 간의 신뢰성 있는 데이터 전송 담당
- 알맞은 **하드웨어로 데이터가 전달되도록 MAC 주소**를 핸들링
- 데이터 패킷을 전기신호로 변환하여 선로를 통해 전달할 수 있게 해줌

### L2 : Internet Layter (OSI 네트워크 계층)

- IP를 담당
- IP를 사용하여 데이터의 **원천지와 목적지**에 관한 정보를 첨부
- 데이터를 빠르게 보내는 것에 집중

**프로토콜** : IP, ICMP, ARP, RARP

### L3 : Transport Layer (OSI 전송 계층)

- TCP는 IP 위에서 동작하는 프로토콜로, 데이터의 전달을 보증하고 순서를 보장한다.

**프로토콜** : TCP, UDP

### L4 : Application Layer 

- 서버나 클라이언트 응용 프로그램이 동작

**프로토콜** : DNS, SNMP, FTP, TFTP, HTTP

## TCP / IP 동작 순서

![](../../images/스크린샷%202026-01-28%2021.28.40.png)

### 송신측

1. **애플리케이션 계층 송신** : 클라이언트 HTTP 요청
2. **트랜스포트 계층 데이터 분해** : 애플리케이션에서 받은 HTTP 메시지를 조각내어 **안내 번호와 포트 번호(TCP패킷)** 를 붙여 네트워크 계층에 전달
3. **네트워크 계층 패킷 추가** : 데이터에 **IP 패킷을 추가**해서 링크 계층에 전달
4. **링크 계층** : **수신지 MAC 주소**와 이더넷 프레임 추가
5. ---송신할 준비 완료---

### 수신측
6. 서버는 링크 계층에서 데이터를 받아들여 순서대로 위의 계층에 전달
7. 애플리케이션 계층에 도달하면, 처음에 클라이언트가 발신했던 HTTP 요청을 수신할 수 있음

