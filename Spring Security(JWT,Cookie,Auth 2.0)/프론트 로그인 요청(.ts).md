#frontend #security #typescript

## 개요

- 클라이언트가 처음에 로그인 요청을 할 때 프론트에서는 어떤 작업을 처리해야 하는지 알아보자.

___


## 구현해야 하는 것들

1. HTML 문서의 id 속성을 이용해 특정 요소(로그인 폼, 아이디, 비밀번호)를 찾아온다.
2. 폼 제출 이벤트 감지
3. 입력값 가져오기
4. fetch API로 서버와 통신
5. 서버 응답 처리
6. **로그인 시에만 AccessToken 을 바디에서 추출한다.**
7. AccessToken을 localStorage 에 저장
8. 에러 처리

### 코드 구현

####  1. 필요한 dom 값 가져오기

```javascript
const loginForm = document.getElementById('login-form') as HTMLFormElement;
const emailInput = document.getElementById('email') as HTMLInputElement;
const passwordInput = document.getElementById('password') as HTMLInputElement;
const loginButton = document.getElementById('login-button') as HTMLButtonElement;
```

#### 2. 폼 제출 이벤트 감지

```javascript
loginForm.addEventListener('submit',async (event: Event) => {

event.preventDefault();
const email = emailInput.value;
const password = passwordInput.value;
 
try{

const response = await fetch('http://localhost:8080/v1/api/admin/login',{
	method: 'POST',
	headers: {
	'Content-Type': 'application/json',
	},
	body: JSON.stringify({ email, password }),
});

if(response.ok) {
	const data = await response.json(); 
	const accessToken = data.accessToken;

	if(accessToken){
		localStorage.setItem('accessToken',accessToken);
		window.location.href = 'games.html';
	} else {
		console.error('엑세스 토큰이 없습니다.');
		alert('로그인에 실패했습니다. 다시 시도해주세요.');
	}
} else {
	const errorData = await response.json();
	alert('로그인 실패 : ${errorData.message}');
	}
} catch(error){
	console.error('로그인 중 오류 발생 : ', error);
	alert('네트워크 오류 발생')
}

})
```

1. email 과 password 를 DOM 에서 가져온다.
2. 백엔드 서버의 API 경로에 fetch 한다.
	- Content-Type 을 application/json 으로 받아오므로 body 부분에서 email 과 password 를 역직렬화한다.
3. __응답 바디의 Authorization 키 값에서 AccessToken 을 추출한다.__
4. 꺼내온 AccessToken 을 localStorage 에 저장한다.