#AWS #spring개념 


## 사진 업로드

1. Controller 에서 MultipartFile 을 받음

2. S3 에 저장될 파일명 생성
```java
public String toUrls(final MultipartFile file) {  
    LocalDateTime now = LocalDateTime.now();  
    DateTimeFormatter dateTimeFormatter =  
            DateTimeFormatter.ofPattern("yyyyMMdd");  
    String createdDate = now.format(dateTimeFormatter);  
    String uuid = UUID.randomUUID().toString();  
    String ext = file.getOriginalFilename().substring(file.getOriginalFilename().lastIndexOf("."));  
    return createdDate + File.separator + uuid + ext;  
}
```

- "yyyyMMdd" 형식으로 생성 날짜를 기준으로 파일명과 더불어서 생성한다.

3. 사진 업로드
```java
public void fileUpload(final MultilpartFile file, final String fileName) {
	try{
		InputStream input = file.getInputStream();
		ObjectMetadata metadata = new ObjectMetadata();
		metadata.setContentLength(file.getSize());
		amazonS3.putObject(bucketName, fileName, input, metadata);
	}
	catch (IOException e) {  
	    throw new S3UploadException(e.getMessage());  
	}
}
```

4. DB 저장
	- Board 엔티티의 imageUrl 에 **파일 경로만 저장**하고 파일 자체는 S3 에 저장

## 사진 조회

1. 게시물 상세 정보 요청
2. DB에서 경로 문자열 응답
3. 프론트는 서버에서 받은 경로 문자열에 S3의 기본 경로를 조합하여 S3에서 실물 이미지를 가져온다.
