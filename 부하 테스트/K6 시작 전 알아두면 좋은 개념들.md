#부하테스트 #k6

# 개요
 
k6 는 부하테스트(Load Testing)와 성능 테스트(Performance Testing) 에 쓰이는 도구이다.
- JavaScript 기반 스크립트를 작성해서 테스트를 실행한다.
- HTTP 요청 테스트에 최적화 되어 있다.

___

# 주요 성능 지표


| 용어                  | 설명                          |
| ------------------- | --------------------------- |
| **Latency(지연시간)**   | 요청에서 응답까지 걸린 총 시간           |
| **Throughput(처리량)** | 일정 시간동안 얼마나 많은 양을 처리할 수 있는지 |
| **Iterations(반복)**  | 같은 행위를 얼마만큼 안정적으로 반복할 수 있는지 |

___

# 용어 설명

| 개념           | 설명             |
| ------------ | -------------- |
| **vus**      | 가상의 동시 유저 수    |
| **duration** | 테스트 진행 시간      |
| **sleep(1)** | 사용자당 1초에 1회 요청 |
| **RPS**      | 초당 요청 수        |

# k6 테스트 스크립트 예제

### 📌 get()

```javascript
import http from 'k6/http';
import { sleep } from 'k6';

export const options = {
	vus: 10,
	duration: "10s",
}

export default function(){
	http.get('http://test.k6.io');
	sleep(1)
}
```

### 📌 post()

```javascript
import http from 'k6/http';
export default function() {
		const url = 'http://test.k6.io/login';
		const payload = JSON.stringify({
		email: 'aaa',
		password: 'bbb'
		});
		const params = {
				headers: {
						'Content-Type' : 'application/json',
						},
				};
				http.post(url,payload,params);
}
```


### 실행

`k6 run [script 명]`

___

# 성능 수집 항목

| 매트릭 이름                  | 설명                                              |
| ----------------------- | ----------------------------------------------- |
| **vus**                 | 현재 활성화된 사용자 유저                                  |
| **vus_max**             | 가능한 최대 가상 사용자 수                                 |
| **iterations**          | 테스트에서 vu 가 JS 스크립트를 실행한 총 횟수                    |
| **iteration_duration**  | default/main function 의 전체 반복을 한 번 완료하는데 소요된 시간 |
| **data_received**       | 데이터를 전달받은 양                                     |
| **data_sent**           | 데이터를 전달한 양                                      |
| **checks**              | 성공적으로 체크된 Rate                                  |
| **http_reqs**           | 생성한 요청 횟수                                       |
| **http_req_blocked**    | 요청 전 차단된 시간                                     |
| **http_req_connecting** | 원격 호스트에 대한 TCP 연결 설정 소요 시간                      |
| **http_req_waiting**    | 원격 호스트로부터 응답을 대기하는데 소요된 시간                      |
| **http_req_sending**    | 원격 호스트에 데이터를 보내는데 소요된 시간                        |
| **http_req_receiving**  | 원격 호스트로부터 응답 데이터를 수신하는데 소요된 시간                  |
| **http_req_duration**   | 요청~응답의 총 시간                                     |

# p(90) 과 p(95)의 의미

**p(90)** : "90% 의 요청이 주어진 지연보다 빠르거나 동일한 시간 안에 완료되었다."
**p(95)** : "95% 의 요청이 주어진 지연보다 빠르거나 동일한 시간 안에 완료되었다."

### 예시

p(90) = 439.21ms 
:  90% 이상의 요청은 439.21ms 내에 성공적으로 이루어짐


#### 평균값으로 성능을 판단하면 안되는 이유

만약 80%의 사용자 400명은 20초안에 응답을 받고, 20%의 사용자 100명은 10분 이상 걸렸다고 해보자.
여기서 평균 응답 시간은 4분이기 때문에 응답 시간이 늦었다고 판단할 수 있다.

100% 의 근접한 사용자의 지표를 사용해야 성능 지표 분석에 더 정확한 정보를 얻을 수 있다.
따라서 평균 응답 시간이 아닌 **성능 지표 분석에는 p(90) or p(95)** 를 이용한다.
